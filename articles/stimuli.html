<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="description" content="webmorphR">
<title>Making Stimuli • webmorphR</title>
<!-- favicons --><link rel="icon" type="image/png" sizes="16x16" href="../favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="../favicon-32x32.png">
<link rel="apple-touch-icon" type="image/png" sizes="180x180" href="../apple-touch-icon.png">
<link rel="apple-touch-icon" type="image/png" sizes="120x120" href="../apple-touch-icon-120x120.png">
<link rel="apple-touch-icon" type="image/png" sizes="76x76" href="../apple-touch-icon-76x76.png">
<link rel="apple-touch-icon" type="image/png" sizes="60x60" href="../apple-touch-icon-60x60.png">
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.1.0/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.1.0/bootstrap.bundle.min.js"></script><link href="../deps/_Nunito-0.4.1/font.css" rel="stylesheet">
<!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- bootstrap-toc --><script src="https://cdn.rawgit.com/afeld/bootstrap-toc/v1.0.1/dist/bootstrap-toc.min.js"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- search --><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- pkgdown --><script src="../pkgdown.js"></script><link href="../extra.css" rel="stylesheet">
<meta property="og:title" content="Making Stimuli">
<meta property="og:description" content="webmorphR">
<meta property="og:image" content="https://debruine.github.io/webmorphR/articles/images/stimuli/stimuli.png">
<meta property="og:image:alt" content="webmorphR logo: a blue hexagon with a simplified white wireframe face">
<meta name="twitter:card" content="summary">
<meta name="twitter:creator" content="@lisadebruine">
<meta name="twitter:site" content="@webmorph_org">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>
    

    <nav class="navbar fixed-top navbar-dark navbar-expand-lg bg-primary"><div class="container">
    
    <a class="navbar-brand me-2" href="../index.html">webmorphR</a>

    <small class="nav-text text-danger me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="Unreleased version">0.0.2.9003</small>

    
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item">
  <a class="nav-link" href="../articles/webmorphR.html">Get started</a>
</li>
<li class="nav-item">
  <a class="nav-link" href="../reference/index.html">Reference</a>
</li>
<li class="active nav-item dropdown">
  <a href="#" class="nav-link dropdown-toggle" data-bs-toggle="dropdown" role="button" aria-expanded="false" aria-haspopup="true" id="dropdown-articles">Articles</a>
  <div class="dropdown-menu" aria-labelledby="dropdown-articles">
    <a class="dropdown-item" href="../articles/stimuli.html">Making Stimuli</a>
    <a class="dropdown-item" href="../articles/manip.html">Image Manipulations</a>
    <a class="dropdown-item" href="../articles/masking.html">Templates and Masking</a>
    <a class="dropdown-item" href="../articles/figures.html">Making Figures</a>
    <a class="dropdown-item" href="../articles/similarity.html">Image Similarity</a>
  </div>
</li>
<li class="nav-item">
  <a class="nav-link" href="../news/index.html">Changelog</a>
</li>
      </ul>
<form class="form-inline my-2 my-lg-0" role="search">
        <input type="search" class="form-control me-sm-2" aria-label="Toggle navigation" name="search-input" data-search-index="../search.json" id="search-input" placeholder="Search for" autocomplete="off">
</form>

      <ul class="navbar-nav">
<li class="nav-item">
  <a class="external-link nav-link" href="https://twitter.com/webmorph_org" aria-label="Twitter">
    <span class="fa fa-twitter"></span>
     
  </a>
</li>
<li class="nav-item">
  <a class="external-link nav-link" href="https://figshare.com/search?q=webmorph%20psychomorph" aria-label="Figshare">
    <span class="ai ai-figshare"></span>
     
  </a>
</li>
<li class="nav-item">
  <a class="external-link nav-link" href="https://github.com/debruine/webmorphR/" aria-label="github">
    <span class="fab fa fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>

    
  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main"><div class="page-header">
      <img src="../logo.png" class="logo" alt=""><h1>Making Stimuli</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/debruine/webmorphR/blob/HEAD/vignettes/stimuli.Rmd" class="external-link"><code>vignettes/stimuli.Rmd</code></a></small>
      <div class="d-none name"><code>stimuli.Rmd</code></div>
    </div>

    
    
<p>This vignette will show some recipes for common types of stimulus
creation.</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># load packages and set maximum plot width</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://debruine.github.io/webmorphR">webmorphR</a></span><span class="op">)</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va">webmorphR.stim</span><span class="op">)</span> <span class="co"># for extra stimulus sets</span>
<span class="fu"><a href="../reference/wm_opts.html">wm_opts</a></span><span class="op">(</span>plot.maxwidth <span class="op">=</span> <span class="fl">850</span><span class="op">)</span></code></pre></div>
<div class="section level2">
<h2 id="averageness">Averageness<a class="anchor" aria-label="anchor" href="#averageness"></a>
</h2>
<div class="section level3">
<h3 id="load-demo-images">Load demo images<a class="anchor" aria-label="anchor" href="#load-demo-images"></a>
</h3>
<p>Let’s start with a set of images from the demo image sets. You need
to have the <a href="https://github.com/debruine/webmorphR.stim" class="external-link">webmorphR.stim</a>
package installed if you haven’t done that already.</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu">remotes</span><span class="fu">::</span><span class="fu"><a href="https://remotes.r-lib.org/reference/install_github.html" class="external-link">install_github</a></span><span class="op">(</span><span class="st">"debruine/webmorphR.stim"</span><span class="op">)</span></code></pre></div>
</div>
<div class="section level3">
<h3 id="add-info">Add info<a class="anchor" aria-label="anchor" href="#add-info"></a>
</h3>
<p>You can add data to an image set to use in subsetting the images. For
demonstration, the “london” image set has a data table called
<code>london_info</code>.</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">london_info</span><span class="op">)</span>
<span class="co">#&gt; <span style="color: #949494;"># A tibble: 6 × 4</span></span>
<span class="co">#&gt;   face_id face_age face_gender face_eth  </span>
<span class="co">#&gt;   <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>      <span style="color: #949494; font-style: italic;">&lt;int&gt;</span> <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>       <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>     </span>
<span class="co">#&gt; <span style="color: #BCBCBC;">1</span> 001           24 female      white     </span>
<span class="co">#&gt; <span style="color: #BCBCBC;">2</span> 002           24 female      white     </span>
<span class="co">#&gt; <span style="color: #BCBCBC;">3</span> 003           38 female      white     </span>
<span class="co">#&gt; <span style="color: #BCBCBC;">4</span> 004           30 male        white     </span>
<span class="co">#&gt; <span style="color: #BCBCBC;">5</span> 005           28 male        east_asian</span>
<span class="co">#&gt; <span style="color: #BCBCBC;">6</span> 006           31 female      west_asian</span></code></pre></div>
<p>Use <code><a href="../reference/add_info.html">add_info()</a></code> to add the data. If the data table isn’t
in the same order as the stimuli, you can match the stimulus item names
to a data column using <code>.by</code>.</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">stimuli</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/webmorphR.stim/man/load_stim.html" class="external-link">load_stim_london</a></span><span class="op">(</span><span class="op">)</span> |&gt;
  <span class="fu"><a href="../reference/add_info.html">add_info</a></span><span class="op">(</span><span class="va">london_info</span><span class="op">)</span></code></pre></div>
</div>
<div class="section level3">
<h3 id="subset">Subset<a class="anchor" aria-label="anchor" href="#subset"></a>
</h3>
<p>Select images from your stimuli to make a new image subset. The
original images are large, and we don’t need the resulting stimuli to be
that large, so we’ll reduce image size by 50% right at the start to
reduce processing time.</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">subset</span> <span class="op">&lt;-</span> <span class="va">stimuli</span> |&gt;
  <span class="fu"><a href="https://rdrr.io/r/base/subset.html" class="external-link">subset</a></span><span class="op">(</span><span class="va">face_eth</span> <span class="op">==</span> <span class="st">"black"</span><span class="op">)</span> |&gt;
  <span class="fu"><a href="https://rdrr.io/r/base/subset.html" class="external-link">subset</a></span><span class="op">(</span><span class="va">face_gender</span> <span class="op">==</span> <span class="st">"male"</span><span class="op">)</span> |&gt;
  <span class="fu"><a href="../reference/resize.html">resize</a></span><span class="op">(</span><span class="fl">.5</span><span class="op">)</span>

<span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">subset</span>, nrow <span class="op">=</span> <span class="fl">2</span><span class="op">)</span></code></pre></div>
<p><img src="images/stimuli/subset-1.png" width="100%"></p>
</div>
<div class="section level3">
<h3 id="align">Align<a class="anchor" aria-label="anchor" href="#align"></a>
</h3>
<p>Next, align the images using Procrustes normalisation to the position
of the first image. They need to have templates fitted to do this. The
function <code><a href="../reference/patch.html">patch()</a></code> is used to match the background colour as
closely as possible.</p>
<p>The <code>horiz_eyes</code> function just makes sure that the first
image has good alignment, since his head is slightly tilted.</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># get patch color for each image from top 10 pixels</span>
<span class="va">patch_fill</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/patch.html">patch</a></span><span class="op">(</span><span class="va">subset</span>, x1 <span class="op">=</span> <span class="fl">0</span>, x2 <span class="op">=</span> <span class="fl">1</span>, y1 <span class="op">=</span> <span class="fl">0</span>, y2 <span class="op">=</span> <span class="fl">10</span><span class="op">)</span>

<span class="va">aligned</span> <span class="op">&lt;-</span> <span class="va">subset</span> |&gt;
  <span class="fu"><a href="../reference/horiz_eyes.html">horiz_eyes</a></span><span class="op">(</span>fill <span class="op">=</span> <span class="va">patch_fill</span><span class="op">)</span> |&gt;
  <span class="fu"><a href="../reference/align.html">align</a></span><span class="op">(</span>procrustes <span class="op">=</span> <span class="cn">TRUE</span>, fill <span class="op">=</span> <span class="va">patch_fill</span><span class="op">)</span>

<span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">aligned</span>, nrow <span class="op">=</span> <span class="fl">2</span><span class="op">)</span></code></pre></div>
<p><img src="images/stimuli/align-1.png" width="100%"></p>
<p><strong>Note</strong>: If you get an error message about rgl or
dynlib, and are using a Mac, you may need to install <a href="https://www.xquartz.org/" class="external-link">XQuartz</a>.</p>
</div>
<div class="section level3">
<h3 id="crop">Crop<a class="anchor" aria-label="anchor" href="#crop"></a>
</h3>
<p>You may also want to crop the images to a 3x4 aspect ratio by setting
width to 60% of the image and height to 80%. By default,
<code><a href="../reference/crop.html">crop()</a></code> will center the cropping, but you can also manually
set the x and y offsets. Values less than 2.0 are interpreted as
percentages, while values greater than 2.0 are interpreted as
pixels.</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">cropped</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/crop.html">crop</a></span><span class="op">(</span><span class="va">aligned</span>, width <span class="op">=</span> <span class="fl">0.6</span>, height <span class="op">=</span> <span class="fl">0.8</span>, y_off <span class="op">=</span> <span class="fl">.05</span><span class="op">)</span>

<span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">cropped</span>, nrow <span class="op">=</span> <span class="fl">2</span><span class="op">)</span></code></pre></div>
<p><img src="images/stimuli/crop-1.png" width="100%"></p>
</div>
<div class="section level3">
<h3 id="average">Average<a class="anchor" aria-label="anchor" href="#average"></a>
</h3>
<p>Now we can make an average version of these faces. This uses the
morphing functions available on the web app, so you need to have an
internet connection. It usually takes 1-4 seconds per image to upload
your images to the server for processing.</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">avg</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/avg.html">avg</a></span><span class="op">(</span><span class="va">cropped</span><span class="op">)</span>

<span class="co"># show average with and without template</span>
<span class="fu"><a href="../reference/draw_tem.html">draw_tem</a></span><span class="op">(</span><span class="va">avg</span><span class="op">)</span> |&gt; <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">avg</span><span class="op">)</span> |&gt; <span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="op">)</span></code></pre></div>
<p><img src="images/stimuli/average-1.png" width="100%"></p>
</div>
<div class="section level3">
<h3 id="transform">Transform<a class="anchor" aria-label="anchor" href="#transform"></a>
</h3>
<p>You can use this average face to transform the individual faces in
distinctiveness and averageness. Give the shape vector names to set the
output names automatically.</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">transf</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/trans.html">trans</a></span><span class="op">(</span>trans_img <span class="op">=</span> <span class="va">cropped</span>,
                from_img <span class="op">=</span> <span class="va">avg</span>,
                to_img <span class="op">=</span> <span class="va">cropped</span>,
                shape <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span>avg <span class="op">=</span> <span class="op">-</span><span class="fl">0.5</span>, dist <span class="op">=</span> <span class="fl">0.5</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<p>Use <code><a href="https://rdrr.io/r/base/subset.html" class="external-link">subset()</a></code> to plot by row.</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="../reference/plot_rows.html">plot_rows</a></span><span class="op">(</span>
  <span class="st">"More Average"</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/subset.html" class="external-link">subset</a></span><span class="op">(</span><span class="va">transf</span>, <span class="st">"avg"</span><span class="op">)</span>,
  <span class="st">"Original"</span> <span class="op">=</span> <span class="va">cropped</span>,
  <span class="st">"More Distinctive"</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/subset.html" class="external-link">subset</a></span><span class="op">(</span><span class="va">transf</span>, <span class="st">"dist"</span><span class="op">)</span>,
  top_label <span class="op">=</span> <span class="cn">TRUE</span>
<span class="op">)</span></code></pre></div>
<p><img src="images/stimuli/male-grid-1.png" width="100%"></p>
</div>
<div class="section level3">
<h3 id="save-stimuli">Save stimuli<a class="anchor" aria-label="anchor" href="#save-stimuli"></a>
</h3>
<p>Now you can set names and save your individual stimuli in a directory
to use in studies. The code below will create a directory called
“stimuli” in your working directory if there isn’t one already. You can
write to any format that <code><a href="https://docs.ropensci.org/magick/reference/editing.html" class="external-link">magick::image_write()</a></code> handles,
such as “png”, “jpeg”, or “gif” (the default is “png”).</p>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">avg</span> |&gt; <span class="fu"><a href="../reference/write_stim.html">write_stim</a></span><span class="op">(</span>dir <span class="op">=</span> <span class="st">"stimuli"</span>, 
                   names <span class="op">=</span> <span class="st">"m_avg"</span>, 
                   format <span class="op">=</span> <span class="st">"jpg"</span><span class="op">)</span></code></pre></div>
<p>Use <code><a href="../reference/rename_stim.html">rename_stim()</a></code> to search and replace patterns, add
prefixes or suffixes, or replace the names with a new vector of names.
The London images in the <code>stimsets</code> package have “_03”
appended to designate that they are the neutral front version from the
<a href="https://figshare.com/articles/dataset/Face_Research_Lab_London_Set/5047666" class="external-link">larger
set</a>, which also includes smiling images and several different
viewpoints.</p>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">cropped</span> |&gt;
  <span class="fu"><a href="../reference/rename_stim.html">rename_stim</a></span><span class="op">(</span>pattern <span class="op">=</span> <span class="st">"_03"</span>, 
           replacement <span class="op">=</span> <span class="st">""</span>, 
           prefix <span class="op">=</span> <span class="st">"orig_"</span><span class="op">)</span> |&gt;
  <span class="fu"><a href="../reference/write_stim.html">write_stim</a></span><span class="op">(</span>dir <span class="op">=</span> <span class="st">"stimuli"</span>, format <span class="op">=</span> <span class="st">"jpg"</span><span class="op">)</span>

<span class="va">transf</span> |&gt;
  <span class="fu"><a href="../reference/rename_stim.html">rename_stim</a></span><span class="op">(</span>pattern <span class="op">=</span> <span class="st">"_03"</span>, replacement <span class="op">=</span> <span class="st">""</span><span class="op">)</span> |&gt;
  <span class="fu"><a href="../reference/write_stim.html">write_stim</a></span><span class="op">(</span>dir <span class="op">=</span> <span class="st">"stimuli"</span>, format <span class="op">=</span> <span class="st">"jpg"</span><span class="op">)</span></code></pre></div>
</div>
<div class="section level3">
<h3 id="repeat">Repeat<a class="anchor" aria-label="anchor" href="#repeat"></a>
</h3>
<p>Now you can pipe all of the commands together and apply them to a new
set of images, such as all the black women in the set.</p>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># subset and resize</span>
<span class="va">resized</span> <span class="op">&lt;-</span> <span class="va">stimuli</span> |&gt;
  <span class="fu"><a href="https://rdrr.io/r/base/subset.html" class="external-link">subset</a></span><span class="op">(</span><span class="va">face_gender</span> <span class="op">==</span> <span class="st">"female"</span><span class="op">)</span> |&gt;
  <span class="fu"><a href="https://rdrr.io/r/base/subset.html" class="external-link">subset</a></span><span class="op">(</span><span class="va">face_eth</span> <span class="op">==</span> <span class="st">"black"</span><span class="op">)</span> |&gt;
  <span class="fu"><a href="../reference/resize.html">resize</a></span><span class="op">(</span><span class="fl">.5</span><span class="op">)</span>

<span class="co"># get patch color for each image</span>
<span class="va">patch_fill</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/patch.html">patch</a></span><span class="op">(</span><span class="va">resized</span>, x1 <span class="op">=</span> <span class="fl">0</span>, x2 <span class="op">=</span> <span class="fl">1</span>, y1 <span class="op">=</span> <span class="fl">0</span>, y2 <span class="op">=</span> <span class="fl">10</span><span class="op">)</span>

<span class="co"># align and crop</span>
<span class="va">cropped</span> <span class="op">&lt;-</span> <span class="va">resized</span> |&gt;
  <span class="fu"><a href="../reference/horiz_eyes.html">horiz_eyes</a></span><span class="op">(</span>fill <span class="op">=</span> <span class="va">patch_fill</span><span class="op">)</span> |&gt;
  <span class="fu"><a href="../reference/align.html">align</a></span><span class="op">(</span>procrustes <span class="op">=</span> <span class="cn">TRUE</span>, fill <span class="op">=</span> <span class="va">patch_fill</span><span class="op">)</span> |&gt;
  <span class="fu"><a href="../reference/crop.html">crop</a></span><span class="op">(</span>width <span class="op">=</span> <span class="fl">0.6</span>, height <span class="op">=</span> <span class="fl">0.8</span>, y_off <span class="op">=</span> <span class="fl">0.05</span><span class="op">)</span>

<span class="co"># average</span>
<span class="va">avg</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/avg.html">avg</a></span><span class="op">(</span><span class="va">cropped</span><span class="op">)</span>

<span class="co"># transform</span>
<span class="va">transf</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/trans.html">trans</a></span><span class="op">(</span>trans_img <span class="op">=</span> <span class="va">cropped</span>,
                from_img <span class="op">=</span> <span class="va">avg</span>,
                to_img <span class="op">=</span> <span class="va">cropped</span>,
                shape <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span>avg <span class="op">=</span> <span class="op">-</span><span class="fl">0.5</span>, dist <span class="op">=</span> <span class="fl">0.5</span><span class="op">)</span><span class="op">)</span>

<span class="co"># save</span>
<span class="va">avg</span> |&gt; <span class="fu"><a href="../reference/write_stim.html">write_stim</a></span><span class="op">(</span><span class="st">"stimuli"</span>, <span class="st">"f_avg"</span>, <span class="st">"jpg"</span><span class="op">)</span>

<span class="va">cropped</span> |&gt;
  <span class="fu"><a href="../reference/rename_stim.html">rename_stim</a></span><span class="op">(</span>pattern <span class="op">=</span> <span class="st">"_03"</span>, 
           replacement <span class="op">=</span> <span class="st">""</span>, 
           prefix <span class="op">=</span> <span class="st">"orig_"</span><span class="op">)</span> |&gt;
  <span class="fu"><a href="../reference/write_stim.html">write_stim</a></span><span class="op">(</span><span class="st">"stimuli"</span>, format <span class="op">=</span> <span class="st">"jpg"</span><span class="op">)</span>

<span class="va">transf</span> |&gt;
  <span class="fu"><a href="../reference/rename_stim.html">rename_stim</a></span><span class="op">(</span>pattern <span class="op">=</span> <span class="st">"_03"</span>, replacement <span class="op">=</span> <span class="st">""</span><span class="op">)</span> |&gt;
  <span class="fu"><a href="../reference/write_stim.html">write_stim</a></span><span class="op">(</span><span class="st">"stimuli"</span>, format <span class="op">=</span> <span class="st">"jpg"</span><span class="op">)</span></code></pre></div>
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="../reference/plot_rows.html">plot_rows</a></span><span class="op">(</span>
  <span class="st">"More Average"</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/subset.html" class="external-link">subset</a></span><span class="op">(</span><span class="va">transf</span>, <span class="st">"avg"</span><span class="op">)</span>,
  <span class="st">"Original"</span> <span class="op">=</span> <span class="va">cropped</span>,
  <span class="st">"More Distinctive"</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/subset.html" class="external-link">subset</a></span><span class="op">(</span><span class="va">transf</span>, <span class="st">"dist"</span><span class="op">)</span>,
  top_label <span class="op">=</span> <span class="cn">TRUE</span>
<span class="op">)</span></code></pre></div>
<p><img src="images/stimuli/female-grid-1.png" width="100%"></p>
</div>
</div>
<div class="section level2">
<h2 id="sexual-dimorphism">Sexual Dimorphism<a class="anchor" aria-label="anchor" href="#sexual-dimorphism"></a>
</h2>
<div class="section level3">
<h3 id="read-in-images">Read in images<a class="anchor" aria-label="anchor" href="#read-in-images"></a>
</h3>
<p>To manipulate sexual dimorphism, you need male and female average
faces like the ones created above. Load them from the saved files in the
“stimuli” directory.</p>
<div class="sourceCode" id="cb15"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">avgs</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/read_stim.html">read_stim</a></span><span class="op">(</span>path <span class="op">=</span> <span class="st">"stimuli"</span>, pattern <span class="op">=</span> <span class="st">"(f|m)_avg"</span><span class="op">)</span>
<span class="va">orig</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/read_stim.html">read_stim</a></span><span class="op">(</span>path <span class="op">=</span> <span class="st">"stimuli"</span>, pattern <span class="op">=</span> <span class="st">"orig_"</span><span class="op">)</span></code></pre></div>
</div>
<div class="section level3">
<h3 id="transform-1">Transform<a class="anchor" aria-label="anchor" href="#transform-1"></a>
</h3>
<p>You can then transform them by -50% to feminise and +50% to
masculinise. Remember to give your shape vector names to set the output
names automatically.</p>
<div class="sourceCode" id="cb16"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">sexdim</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/trans.html">trans</a></span><span class="op">(</span>trans_img <span class="op">=</span> <span class="va">orig</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="fl">6</span><span class="op">]</span>,
                from_img <span class="op">=</span> <span class="va">avgs</span><span class="op">$</span><span class="va">f_avg</span>,
                to_img <span class="op">=</span> <span class="va">avgs</span><span class="op">$</span><span class="va">m_avg</span>,
                shape <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span>fem <span class="op">=</span> <span class="op">-</span><span class="fl">0.5</span>, masc <span class="op">=</span> <span class="fl">0.5</span><span class="op">)</span><span class="op">)</span>

<span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">sexdim</span>, nrow <span class="op">=</span> <span class="fl">2</span><span class="op">)</span></code></pre></div>
<p><img src="images/stimuli/sexdim-1.png" width="100%"></p>
</div>
</div>
<div class="section level2">
<h2 id="animate">Animate<a class="anchor" aria-label="anchor" href="#animate"></a>
</h2>
<div class="section level3">
<h3 id="make-a-continuum">Make a continuum<a class="anchor" aria-label="anchor" href="#make-a-continuum"></a>
</h3>
<p>Make a continuum that morphs from the female to the male average in
5% steps. This makes 21 images, so will take a few seconds; be
patient.</p>
<div class="sourceCode" id="cb17"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">continuum</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/continuum.html">continuum</a></span><span class="op">(</span><span class="va">avgs</span><span class="op">$</span><span class="va">f_avg</span>, <span class="va">avgs</span><span class="op">$</span><span class="va">m_avg</span>, <span class="fl">0</span>, <span class="fl">1</span>, <span class="fl">.05</span><span class="op">)</span>

<span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">continuum</span>, nrow <span class="op">=</span> <span class="fl">3</span><span class="op">)</span></code></pre></div>
<p><img src="images/stimuli/unnamed-chunk-6-1.png" width="100%"></p>
</div>
<div class="section level3">
<h3 id="animate-1">Animate<a class="anchor" aria-label="anchor" href="#animate-1"></a>
</h3>
<p>You can turn your images into an animated gif. Resize the images to
the size you want first. Save the resulting image as a gif. If you have
the <code>gifski</code> package installed, this will be used to create
the animated gif and is faster than the <code>magick</code> algorithm
(you don’t have to load <code>gifski</code> for it to be used, just
install it).</p>
<div class="sourceCode" id="cb18"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co">#install.packages("gifski") # for faster animation</span>

<span class="va">continuum</span> |&gt;
  <span class="fu"><a href="../reference/resize.html">resize</a></span><span class="op">(</span>width <span class="op">=</span> <span class="fl">180</span><span class="op">)</span> |&gt;
  <span class="fu"><a href="../reference/animate.html">animate</a></span><span class="op">(</span>fps <span class="op">=</span> <span class="fl">20</span>, rev <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></code></pre></div>
<p><img src="images/stimuli/animated-gif-1.gif" width="180px"></p>
<p>When you run this code, even in an R Markdown document, the gif will
show in the Viewer pane, but it will display in the document when you
knit.</p>
</div>
</div>
<div class="section level2">
<h2 id="non-face-stimuli">Non-Face Stimuli<a class="anchor" aria-label="anchor" href="#non-face-stimuli"></a>
</h2>
<p>You can also process images without templates. For example, the
following code takes a group of images and crops them to a standard
size.</p>
<div class="sourceCode" id="cb19"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># load rainbow images</span>
<span class="va">stimuli</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/webmorphR.stim/man/load_stim.html" class="external-link">load_stim_rainbow</a></span><span class="op">(</span><span class="op">)</span>

<span class="co"># get info on the images to put in order by type and colour</span>
<span class="va">info</span> <span class="op">&lt;-</span> <span class="va">rainbow_info</span> |&gt;
  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/arrange.html" class="external-link">arrange</a></span><span class="op">(</span><span class="va">type</span>, <span class="va">colour</span><span class="op">)</span>

<span class="co"># crop to smallest size</span>
<span class="va">width</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/width.html">width</a></span><span class="op">(</span><span class="va">stimuli</span>, <span class="st">"min"</span><span class="op">)</span>
<span class="va">height</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/height.html">height</a></span><span class="op">(</span><span class="va">stimuli</span>, <span class="st">"min"</span><span class="op">)</span>
<span class="va">stim</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/crop.html">crop</a></span><span class="op">(</span><span class="va">stimuli</span>, <span class="va">width</span>, <span class="va">height</span><span class="op">)</span>
<span class="va">stim</span> <span class="op">&lt;-</span> <span class="va">stim</span><span class="op">[</span><span class="va">info</span><span class="op">$</span><span class="va">photo_name</span><span class="op">]</span> <span class="co"># reorder by type and colour</span>

<span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">stim</span>, ncol <span class="op">=</span> <span class="fl">6</span><span class="op">)</span></code></pre></div>
<p><img src="images/stimuli/unnamed-chunk-7-1.png" width="100%"></p>
</div>
<div class="section level2">
<h2 id="blank-stimuli">Blank stimuli<a class="anchor" aria-label="anchor" href="#blank-stimuli"></a>
</h2>
<p>You can make blank images specifying the size and colour.</p>
<div class="sourceCode" id="cb20"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">new_stimuli</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/blank.html">blank</a></span><span class="op">(</span>n <span class="op">=</span> <span class="fl">6</span>, width <span class="op">=</span> <span class="fl">100</span>, height <span class="op">=</span> <span class="fl">100</span>, 
                     color <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"red"</span>, <span class="st">"orange"</span>, <span class="st">"yellow"</span>, <span class="st">"green"</span>, <span class="st">"blue"</span>, <span class="st">"purple"</span><span class="op">)</span><span class="op">)</span>

<span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">new_stimuli</span>, nrow <span class="op">=</span> <span class="fl">1</span><span class="op">)</span></code></pre></div>
<p><img src="images/stimuli/blank-stim-1.png" width="100%"></p>
</div>
<div class="section level2">
<h2 id="word-stimuli">Word Stimuli<a class="anchor" aria-label="anchor" href="#word-stimuli"></a>
</h2>
<p>Create word stimuli by starting with blank images and adding words to
each stimulus with the <code><a href="../reference/label.html">label()</a></code> function.</p>
<div class="sourceCode" id="cb21"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># make a vector of the words and colours they should print in</span>
<span class="va">colours</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span>red <span class="op">=</span> <span class="st">"red3"</span>, 
             orange <span class="op">=</span> <span class="st">"darkorange"</span>, 
             green <span class="op">=</span> <span class="st">"darkgreen"</span>, 
             blue <span class="op">=</span> <span class="st">"dodgerblue3"</span>, 
             purple <span class="op">=</span> <span class="st">"darkorchid"</span><span class="op">)</span>

<span class="co"># make vector of labels (each word in each colour)</span>
<span class="va">n</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">colours</span><span class="op">)</span>
<span class="va">labels</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">colours</span><span class="op">)</span>, each <span class="op">=</span> <span class="va">n</span><span class="op">)</span>

<span class="co"># make 36 blank 800x200px images and add labels</span>
<span class="va">stroop</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/blank.html">blank</a></span><span class="op">(</span><span class="va">n</span><span class="op">*</span><span class="va">n</span>, <span class="fl">800</span>, <span class="fl">200</span><span class="op">)</span> |&gt;
  <span class="fu"><a href="../reference/label.html">label</a></span><span class="op">(</span><span class="va">labels</span>, 
        size <span class="op">=</span> <span class="fl">100</span>, 
        color <span class="op">=</span> <span class="va">colours</span>, 
        weight <span class="op">=</span> <span class="fl">700</span>,
        gravity <span class="op">=</span> <span class="st">"center"</span><span class="op">)</span>

<span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">stroop</span>, ncol <span class="op">=</span> <span class="va">n</span>, fill <span class="op">=</span> <span class="st">"grey"</span><span class="op">)</span></code></pre></div>
<p><img src="images/stimuli/stroop-words-1.png" width="100%"></p>
<hr>
<p>This script took 2.2 minutes to render all the included images from
scratch.</p>
</div>
  </main><aside class="col-md-3"><nav id="toc"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p></p>
<p>Developed by Lisa DeBruine.</p>
</div>

<div class="pkgdown-footer-right">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.3.</p>
</div>

    </footer>
</div>

  

  

  </body>
</html>
