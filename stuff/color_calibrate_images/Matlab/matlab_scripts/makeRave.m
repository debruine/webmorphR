Rgb_vals=[118.2335737	70.66426282	60.45472756
206.4326923	149.5865385	138.8441506
95.69190705	127.5276442	163.4739583
87.20392628	98.24238782	55.70633013
143.3601763	134.2055288	180.1330128
109.734375	192.9583333	183.7676282
222.478766	113.0052083	36.83613782
73.921875	98.83733974	174.791266
208.0036058	76.04366987	90.58453526
101.0552885	54.51081731	97.41746795
161.7888622	181.4711538	68.09535256
220.7075321	150.822516	29.11778846
36.75480769	64.31009615	143.2211538
75.82451923	150.0512821	76.22516026
201.4479167	46.36458333	49.10857372
226.5	188.7099359	41.54887821
211.0308494	85.88501603	149.646234
42.01883013	149.4643429	180.5372596
230.3609776	228.9451122	227.2972756
201.4483173	199.5084135	201.7856571
165.1101763	162.8802083	165.9266827
119.2888622	117.0508814	118.0885417
74.56570513	74.96113782	77.43910256
37.51322115	35.97636218	38.71394231
];

spectrod65=[37.72333333	11.8	12.50333333
64.48	13.10666667	17.52333333
50.83333333	-4.506666667	-20.06666667
42.46	-10.83666667	21.24666667
55.78	6.773333333	-23.08
70.88	-30.71	3.053333333
60.1	34.79	53.48666667
42.91666667	7.726666667	-40.49333333
49.16	42.01	13.05333333
31.82	18.20666667	-20.58333333
70.28333333	-19.55333333	57.78333333
68.64666667	20.64666667	64.51666667
31.08	10.34	-43.65666667
54.77333333	-34.03333333	34.42333333
40.43666667	44.93333333	24.28
79.19333333	5.173333333	78.63
50.64333333	42.62666667	-16.87666667
53.26333333	-28.80666667	-22.23666667
95.34	-0.576666667	2.68
80.52	-0.476666667	0.163333333
65.63666667	0.13	-0.693333333
50.13666667	-0.04	0.093333333
35.85333333	-0.26	-1.153333333
21.03	-0.053333333	-0.653333333
];



% Calculate camera Characterisation - Least Squares fit of rgb to Lab
% patches:

rgb = Rgb_vals/255;

for i = 1:length(rgb)
    train(i,:) = rgb2rgbpoly(rgb(i,:),11);
end


R=train\spectrod65;

% Calculate predicted lab values from characterisation

lab_calc = train*R;


squaredDifference = (lab_calc-spectrod65).^2;
meanDeltaE = mean(sqrt(sum(squaredDifference')))
maxDeltaE = max(sqrt(sum(squaredDifference')))
